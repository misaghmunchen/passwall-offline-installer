      - name: Feed setup (luci + passwall) with fallback
        run: |
          set -eux
          cd sdk

          # luci رسمی 23.05 + passwall (packages + luci)
          sed -i '/^src-git luci /d' feeds.conf.default || true
          {
            echo "src-git luci https://github.com/openwrt/luci.git;openwrt-23.05"
            echo "src-git passwall_packages https://github.com/xiaorouji/openwrt-passwall-packages"
            echo "src-git passwall_luci https://github.com/xiaorouji/openwrt-passwall;main"
          } >> feeds.conf.default

          # تلاش معمولی با feeds
          ./scripts/feeds update luci passwall_packages passwall_luci || true

          # اگر پوشه‌ها ساخته نشد، دستی کلون کن
          [ -d feeds/passwall_packages ] || git clone --depth 1 https://github.com/xiaorouji/openwrt-passwall-packages feeds/passwall_packages
          [ -d feeds/passwall_luci ]      || git clone --depth 1 https://github.com/xiaorouji/openwrt-passwall          feeds/passwall_luci

          # نصب
          ./scripts/feeds install -a

          # برای اطمینان نمایش وضعیت
          find feeds -maxdepth 1 -type d -printf "%f\n"
